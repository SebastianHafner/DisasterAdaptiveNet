# DisasterAdaptiveNet


This repository contains the official code for the following paper:

Hafner, S.\*, Gerard, S.\*, Sullivan, J. and Ban, Y., 2025. DisasterAdaptiveNet: A Robust Network for Multi-Hazard Building Damage Detection from Very-High-Resolution Satellite Imagery. International Journal of Applied Earth Observation and Geoinformation, (under review).
\* Equal contributions


![alt text](imgs/disasteradaptivenet.png)

# Documentation

This section provides instructions on how to train our DisasterAdaptiveNet and perform inference.


## Setup

### Dataset

The xBD dataset is available from this [link](https://xview2.org/dataset). More information can be found in the [xBD dataset paper](https://openaccess.thecvf.com/content_CVPRW_2019/papers/cv4gc/Gupta_Creating_xBD_A_Dataset_for_Assessing_Building_Damage_from_Satellite_CVPRW_2019_paper.pdf).

We use a metadata file (`metadata.json`) that can be downloaded from [here](https://drive.google.com/file/d/1G5__zFsO7xIwfy2eyjow1NiZL34aWB0e/view?usp=sharing). The metadata file should be placed in the root directory of the xBD dataset (see below). 

The dataset directory should look like this:

```
$ xBD dataset directory
xview2  # -d should point to this directory
├── metadata.json  # Download this file and place it in the dataset directory
├── hold
├── test
├── tier3
└── train
    ├── images
    ├── labels
    └── masks  # This folder is generated by running create_masks.py
```

**An event-based split of xBD**: Our paper also propose and event-based split for the xBD dataset. The split can be set in the config file (`cfg.DATASET.SPLIT: xview2/event`). The sample assignment for the different sets (train/val/test) is also available on Google Drive (.txt files).


### Environment

1. Clone this repository

    ```bash
    git clone https://github.com/SebastianHafner/DisasterAdaptiveNet.git
    cd DisasterAdaptiveNet
    ```

2. Setup a virtual environment

    We use conda to setup the environment:
    ```bash
    conda create -n disasteradaptivenet python=3.8.18
    conda activate disasteradaptivenet
   ```

3. Install the dependencies
    
    Install pytorch according to the [official guide](https://pytorch.org/get-started/locally/).
    
    Install other dependencies using the `requirements.txt` file. Note that not all libraries specified in the file are required to run this code.
    ```bash
    pip install -r requirements.txt
   ```



## Running our code

This section provides all the instructions to run our code. If you do not want to train your own models, we also provide [our model weights](https://drive.google.com/drive/folders/1lx14Z9yw2K44DeUQbOEEfThfPi-6bBxA?usp=sharing) (median run used to generate the qualitative results presented in the paper).

All scripts require three arguments:
- The config file is specified using `-c`. This repo includes configs for the Strong Baseline and the DisasterAdaptiveNet from our paper. Both networks can be trained on the xView2 split (`*_xview2`) or event-based split (`*event`). 
- The output directory is specified using `-o`. We use this directory to store model weights, submission files, and the scores.
- The dataset directory is specified using `-d`. This directory points to the root folder of the xBD dataset.

### Generate masks

We first convert the labels provided as `.json` files into `.png` files. To do that, run the `create_masks.py` file. The labels are stored in `masks` folders located in the respective subset folder of the xBD dataset.

### Training

To train our DisasterAdaptiveNet on the event-based split, run the following script:
 ```bash
 python train_network.py -c disasteradaptivenet_event -o output -d xview2
 ```

### Inference

To produce building damage outputs, run the following script:


 ```bash
 python create_submission.py -c disasteradaptivenet_event -o output -d xview2
 ```

The resulting files follow the format specified in the xView2 Competition. The localization prediction files (`*_localization_disaster_prediction.png`) contain information on building presence (0: no building, 1: building). The damage prediction files (`*_damage_disaster_prediction.png`) contain information on building damage level (0: no building, 1: undamaged building, 2: building with minor damage, 3: building with major damage, 4 destroyed building).


### Competition Score

To compute the xView2 competition score, including task-specific scores, run the following script:

 ```bash
 python compute_metrics.py -c disasteradaptivenet_event -o output -d xview2
 ```

# Credits

If you find this work useful, please consider citing:


  ```bibtex

  ```